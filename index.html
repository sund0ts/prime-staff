<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arizona Prime — Вход</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#070709; --surface:#0d0d12; --border:#16161e;
    --accent1:#e8365d; --accent2:#4a9eff; --accent3:#c77dff;
    --gradient:linear-gradient(135deg,#ff4d6d,#c77dff,#4a9eff);
    --text:#f0f0f4; --muted:#3a3a4a; --card:#0f0f15;
  }
  *{margin:0;padding:0;box-sizing:border-box;}
  html,body{height:100%;overflow:hidden;}
  body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;display:flex;align-items:center;justify-content:center;position:relative;}

  /* Animated BG */
  .bg-orbs{position:fixed;inset:0;pointer-events:none;z-index:0;}
  .orb{position:absolute;border-radius:50%;filter:blur(80px);animation:orb-float 8s ease-in-out infinite;}
  .orb1{width:500px;height:500px;background:radial-gradient(circle,rgba(232,54,93,0.08),transparent 70%);top:-100px;left:-100px;animation-delay:0s;}
  .orb2{width:400px;height:400px;background:radial-gradient(circle,rgba(74,158,255,0.07),transparent 70%);bottom:-80px;right:-80px;animation-delay:3s;}
  .orb3{width:300px;height:300px;background:radial-gradient(circle,rgba(199,125,255,0.06),transparent 70%);top:50%;left:50%;transform:translate(-50%,-50%);animation-delay:5s;}
  @keyframes orb-float{0%,100%{transform:translate(0,0) scale(1);}50%{transform:translate(20px,-20px) scale(1.05);}}
  .orb1{animation-name:orb1-anim;}
  @keyframes orb1-anim{0%,100%{transform:translate(0,0);}50%{transform:translate(40px,30px);}}

  /* Noise */
  body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:1;}

  /* CARD */
  .login-wrap{position:relative;z-index:2;width:100%;max-width:420px;padding:20px;}
  .login-card{background:var(--card);border:1px solid var(--border);border-radius:28px;padding:48px 40px;animation:card-in 0.6s cubic-bezier(.22,1,.36,1) both;}
  @keyframes card-in{from{opacity:0;transform:translateY(24px);}to{opacity:1;transform:translateY(0);}}
  
  .logo-area{text-align:center;margin-bottom:36px;}
  .logo-icon{width:56px;height:56px;margin:0 auto 16px;background:var(--border);border-radius:16px;display:flex;align-items:center;justify-content:center;}
  .logo-icon svg{width:28px;height:28px;}
  .logo-title{font-family:'Syne',sans-serif;font-weight:800;font-size:22px;background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:4px;}
  .logo-sub{font-size:12px;color:var(--muted);letter-spacing:0.08em;text-transform:uppercase;}

  .form-group{margin-bottom:18px;}
  .form-group label{display:block;font-size:11px;font-weight:600;letter-spacing:0.08em;text-transform:uppercase;color:#444;margin-bottom:8px;}
  .input-wrap{position:relative;}
  .input-wrap svg{position:absolute;left:14px;top:50%;transform:translateY(-50%);width:16px;height:16px;color:#333;pointer-events:none;}
  .form-control{width:100%;background:var(--bg);border:1px solid var(--border);border-radius:12px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;padding:13px 14px 13px 42px;transition:border-color .2s;outline:none;}
  .form-control:focus{border-color:#222;}
  .form-control::placeholder{color:#222;}

  /* Remember me */
  .remember-row{display:flex;align-items:center;margin:20px 0;}
  .rem-label{display:flex;align-items:center;gap:10px;cursor:pointer;user-select:none;}
  .rem-box{width:20px;height:20px;border-radius:6px;border:1px solid var(--border);background:var(--bg);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s;}
  .rem-box.on{background:var(--accent1);border-color:var(--accent1);}
  .rem-box svg{display:none;width:11px;height:11px;}
  .rem-box.on svg{display:block;}
  .rem-label span{font-size:13px;color:#555;}
  .rem-label:hover span{color:#888;}
  .rem-label:hover .rem-box{border-color:#333;}
  .rem-days{color:#2a2a2a!important;font-size:11px!important;margin-left:4px;}

  .error-box{background:rgba(232,54,93,.08);border:1px solid rgba(232,54,93,.18);border-radius:10px;padding:11px 14px;font-size:13px;color:var(--accent1);margin-bottom:16px;display:none;}
  
  .btn-login{width:100%;background:var(--gradient);color:#fff;border:none;padding:15px;border-radius:12px;font-family:'Syne',sans-serif;font-size:15px;font-weight:700;cursor:pointer;transition:opacity .2s,transform .2s;letter-spacing:.02em;display:flex;align-items:center;justify-content:center;gap:10px;}
  .btn-login:hover{opacity:.88;transform:translateY(-1px);}
  .btn-login:active{transform:translateY(0);}

  .divider{display:flex;align-items:center;gap:14px;margin:24px 0;color:#1a1a22;font-size:12px;}
  .divider::before,.divider::after{content:'';flex:1;height:1px;background:var(--border);}

  .version{text-align:center;font-size:11px;color:#1e1e28;margin-top:28px;letter-spacing:.04em;}

  /* Loader */
  .spin{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.2);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite;}
  @keyframes spin{to{transform:rotate(360deg);}}
</style>
</head>
<body>
<div class="bg-orbs">
  <div class="orb orb1"></div>
  <div class="orb orb2"></div>
  <div class="orb orb3"></div>
</div>

<div class="login-wrap">
  <div class="login-card">
    <div class="logo-area">
      <div class="logo-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="url(#lg)" stroke-width="1.8">
          <defs><linearGradient id="lg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#ff4d6d"/><stop offset="50%" stop-color="#c77dff"/><stop offset="100%" stop-color="#4a9eff"/></linearGradient></defs>
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
        </svg>
      </div>
      <div class="logo-title">Arizona Prime</div>
      <div class="logo-sub">Портал сотрудников</div>
    </div>

    <div class="error-box" id="errBox">Неверный никнейм или пароль</div>

    <div class="form-group">
      <label>Никнейм</label>
      <div class="input-wrap">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        <input class="form-control" id="nickInput" type="text" placeholder="Ваш никнейм" autocomplete="off">
      </div>
    </div>
    <div class="form-group">
      <label>Пароль</label>
      <div class="input-wrap">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
        <input class="form-control" id="passInput" type="password" placeholder="••••••••">
      </div>
    </div>

    <div class="remember-row">
      <label class="rem-label" onclick="toggleRem()">
        <div class="rem-box" id="remBox">
          <svg viewBox="0 0 12 10" fill="none" stroke="#fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><polyline points="1 5 4.5 8.5 11 1"/></svg>
        </div>
        <span>Запомнить меня <span class="rem-days">· 30 дней</span></span>
      </label>
    </div>

    <button class="btn-login" id="loginBtn" onclick="doLogin()">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
      Войти
    </button>

    <div class="divider">Arizona Prime Staff</div>
  </div>
  <div class="version">v2.0 · Staff Portal · 2026</div>
</div>

<script>
const SB_URL = 'https://mnzayheqmplwgcpgapwn.supabase.co';
const SB_KEY = 'sb_publishable_taiYP-OlMMOXB4NYIpgKOQ_7JLaUPpU';
const SESSION_KEY = 'ap2_session';
const DAYS30 = 30 * 24 * 60 * 60 * 1000;
let rememberMe = false;

async function sbGet(path) {
  const r = await fetch(SB_URL+'/rest/v1/'+path, {headers:{'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY}});
  if (!r.ok) throw new Error(await r.text());
  const t = await r.text(); return t ? JSON.parse(t) : [];
}

function toggleRem() {
  rememberMe = !rememberMe;
  document.getElementById('remBox').classList.toggle('on', rememberMe);
}

async function getIP() {
  try { const r = await fetch('https://api.ipify.org?format=json'); return (await r.json()).ip || 'unknown'; }
  catch { return 'unknown'; }
}

async function doLogin() {
  const nick = document.getElementById('nickInput').value.trim();
  const pass = document.getElementById('passInput').value;
  if (!nick || !pass) return;

  const btn = document.getElementById('loginBtn');
  btn.innerHTML = '<span class="spin"></span>';
  btn.disabled = true;
  document.getElementById('errBox').style.display = 'none';

  try {
    // Root dev account
    if (nick === 'falcone' && pass === 'falcone20110403') {
      const devUser = { id: '__dev__', nickname: 'falcone', real_name: 'Developer', position: 'Разработчик', level: 9, locked: true };
      await loginSuccess(devUser);
      return;
    }

    const rows = await sbGet('users?nickname=eq.'+encodeURIComponent(nick)+'&password=eq.'+encodeURIComponent(pass)+'&select=*');
    if (rows.length) {
      await loginSuccess(rows[0]);
    } else {
      document.getElementById('errBox').style.display = 'block';
    }
  } catch(e) {
    document.getElementById('errBox').textContent = 'Ошибка сети: ' + e.message;
    document.getElementById('errBox').style.display = 'block';
  }

  btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg> Войти';
  btn.disabled = false;
}

async function loginSuccess(user) {
  if (rememberMe) {
    const ip = await getIP();
    localStorage.setItem(SESSION_KEY, JSON.stringify({ user, ip, expires: Date.now() + DAYS30 }));
  } else {
    sessionStorage.setItem(SESSION_KEY, JSON.stringify({ user }));
  }
  window.location.href = 'dashboard.html';
}

async function checkSession() {
  const raw = localStorage.getItem(SESSION_KEY) || sessionStorage.getItem(SESSION_KEY);
  if (!raw) return;
  try {
    const s = JSON.parse(raw);
    if (s.expires && Date.now() > s.expires) { localStorage.removeItem(SESSION_KEY); return; }
    if (s.ip) {
      const ip = await getIP();
      if (ip !== 'unknown' && s.ip !== 'unknown' && ip !== s.ip) { localStorage.removeItem(SESSION_KEY); return; }
    }
    window.location.href = 'dashboard.html';
  } catch { localStorage.removeItem(SESSION_KEY); }
}

document.getElementById('passInput').addEventListener('keydown', e => { if (e.key === 'Enter') doLogin(); });
document.getElementById('nickInput').addEventListener('keydown', e => { if (e.key === 'Enter') document.getElementById('passInput').focus(); });

checkSession();
</script>
</body>
</html>
