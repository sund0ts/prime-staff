<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Arizona Prime — Регистрация</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root{--bg:#070709;--surface:#0d0d12;--border:#16161e;--accent1:#e8365d;--accent2:#4a9eff;--accent3:#c77dff;--gradient:linear-gradient(135deg,#ff4d6d,#c77dff,#4a9eff);--text:#f0f0f4;--muted:#3a3a4a;--card:#0f0f15;}
  *{margin:0;padding:0;box-sizing:border-box;}
  body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:40px 20px;}
  body::after{content:'';position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");pointer-events:none;z-index:0;}
  .orb{position:fixed;border-radius:50%;filter:blur(100px);pointer-events:none;z-index:0;}
  .orb1{width:600px;height:600px;background:radial-gradient(circle,rgba(232,54,93,0.07),transparent);top:-200px;left:-200px;}
  .orb2{width:500px;height:500px;background:radial-gradient(circle,rgba(74,158,255,0.06),transparent);bottom:-200px;right:-200px;}

  .reg-wrap{position:relative;z-index:1;width:100%;max-width:560px;}
  .reg-header{text-align:center;margin-bottom:36px;animation:fadein .5s ease both;}
  @keyframes fadein{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}
  .logo-icon{width:52px;height:52px;margin:0 auto 14px;background:#0f0f15;border:1px solid var(--border);border-radius:14px;display:flex;align-items:center;justify-content:center;}
  .logo-icon svg{width:26px;height:26px;}
  .reg-header h1{font-family:'Syne',sans-serif;font-size:26px;font-weight:800;background:var(--gradient);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:6px;}
  .reg-header p{font-size:13px;color:#444;line-height:1.6;}

  .reg-card{background:var(--card);border:1px solid var(--border);border-radius:24px;padding:40px;animation:fadein .5s ease .1s both;}

  .section-title{font-size:11px;font-weight:700;letter-spacing:.12em;text-transform:uppercase;color:var(--accent1);margin-bottom:20px;display:flex;align-items:center;gap:8px;}
  .section-title::before{content:'';display:block;width:3px;height:14px;background:var(--accent1);border-radius:2px;}
  .section-block{margin-bottom:32px;padding-bottom:32px;border-bottom:1px solid var(--border);}
  .section-block:last-of-type{border-bottom:none;margin-bottom:0;padding-bottom:0;}

  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
  .form-group{margin-bottom:0;}
  .form-group.full{grid-column:1/-1;}
  label{display:block;font-size:11px;font-weight:600;letter-spacing:.07em;text-transform:uppercase;color:#3a3a4a;margin-bottom:7px;}
  .req{color:var(--accent1);}
  .input-wrap{position:relative;}
  .input-wrap svg.ico{position:absolute;left:13px;top:50%;transform:translateY(-50%);width:15px;height:15px;color:#252530;pointer-events:none;}
  .form-control{width:100%;background:var(--bg);border:1px solid var(--border);border-radius:10px;color:var(--text);font-family:'DM Sans',sans-serif;font-size:14px;padding:12px 13px 12px 40px;outline:none;transition:border-color .2s;}
  .form-control:focus{border-color:#252532;}
  .form-control::placeholder{color:#1e1e28;}
  .form-control.no-icon{padding-left:13px;}
  select.form-control{cursor:pointer;}
  select.form-control option{background:#0d0d12;}
  .hint{font-size:11px;color:#2a2a36;margin-top:5px;line-height:1.5;}

  .error-box{background:rgba(232,54,93,.08);border:1px solid rgba(232,54,93,.18);border-radius:10px;padding:11px 14px;font-size:13px;color:var(--accent1);margin-bottom:20px;display:none;}
  .success-box{display:none;text-align:center;padding:40px 20px;}
  .success-box svg{margin:0 auto 16px;display:block;}
  .success-box h3{font-family:'Syne',sans-serif;font-size:20px;font-weight:800;margin-bottom:8px;}
  .success-box p{color:#444;font-size:13px;line-height:1.6;}
  .success-box a{color:var(--accent2);text-decoration:none;font-weight:600;}

  .btn-reg{width:100%;background:var(--gradient);color:#fff;border:none;padding:15px;border-radius:12px;font-family:'Syne',sans-serif;font-size:15px;font-weight:700;cursor:pointer;transition:opacity .2s,transform .2s;letter-spacing:.02em;margin-top:28px;display:flex;align-items:center;justify-content:center;gap:10px;}
  .btn-reg:hover{opacity:.88;transform:translateY(-1px);}
  .back-link{display:block;text-align:center;margin-top:18px;font-size:13px;color:#333;text-decoration:none;transition:color .2s;}
  .back-link:hover{color:#666;}

  .spin{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.25);border-top-color:#fff;border-radius:50%;animation:spin .6s linear infinite;}
  @keyframes spin{to{transform:rotate(360deg);}}
  @media(max-width:520px){.grid2{grid-template-columns:1fr;}.form-group.full{grid-column:auto;}.reg-card{padding:28px 20px;}}
</style>
</head>
<body>
<div class="orb orb1"></div>
<div class="orb orb2"></div>

<div class="reg-wrap">
  <div class="reg-header">
    <div class="logo-icon">
      <svg viewBox="0 0 24 24" fill="none" stroke="url(#lg)" stroke-width="1.8">
        <defs><linearGradient id="lg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#ff4d6d"/><stop offset="100%" stop-color="#4a9eff"/></linearGradient></defs>
        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
      </svg>
    </div>
    <h1>Регистрация сотрудника</h1>
    <p>Только для действующих участников Arizona Prime.<br>Ссылка конфиденциальна — не передавай посторонним.</p>
  </div>

  <div class="reg-card">
    <div class="error-box" id="errBox">Ошибка регистрации</div>

    <div id="regForm">
      <!-- PERSONAL -->
      <div class="section-block">
        <div class="section-title">Личные данные</div>
        <div class="grid2">
          <div class="form-group">
            <label>Никнейм <span class="req">*</span></label>
            <div class="input-wrap">
              <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
              <input class="form-control" id="f_nick" type="text" placeholder="Carl_Johnson" autocomplete="off">
            </div>
          </div>
          <div class="form-group">
            <label>Пароль <span class="req">*</span></label>
            <div class="input-wrap">
              <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
              <input class="form-control" id="f_pass" type="password" placeholder="Минимум 6 символов">
            </div>
          </div>
          <div class="form-group full">
            <label>Реальное имя <span class="req">*</span></label>
            <div class="input-wrap">
              <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              <input class="form-control" id="f_name" type="text" placeholder="Иван Иванов">
            </div>
          </div>
        </div>
      </div>

      <!-- POSITION -->
      <div class="section-block">
        <div class="section-title">Должность и уровень</div>
        <div class="grid2">
          <div class="form-group full">
            <label>Должность <span class="req">*</span></label>
            <div class="input-wrap">
              <svg class="ico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
              <input class="form-control" id="f_pos" type="text" placeholder="Администратор ивентов">
            </div>
          </div>
          <div class="form-group">
            <label>Уровень <span class="req">*</span></label>
            <select class="form-control no-icon" id="f_level">
              <option value="">— выбрать —</option>
              <option value="1">1 — Академик</option>
              <option value="2">2 — Рыцарь</option>
              <option value="3">3 — Администратор</option>
              <option value="4">4 — Следящий за академией</option>
              <option value="5">5 — Куратор отдела</option>
              <option value="6">6 — Руководитель отдела</option>
              <option value="7">7 — Заместитель Директора</option>
              <option value="8">8 — Директор</option>
            </select>
          </div>
          <div class="form-group">
            <label>Дата постановления <span class="req">*</span></label>
            <input class="form-control no-icon" id="f_appoint" type="date">
          </div>
          <div class="form-group">
            <label>Дата последнего повышения</label>
            <input class="form-control no-icon" id="f_promo" type="date">
          </div>
        </div>
      </div>

      <!-- SOCIAL -->
      <div class="section-block">
        <div class="section-title">Соцсети</div>
        <div class="grid2">
          <div class="form-group">
            <label>Discord</label>
            <div class="input-wrap">
              <svg class="ico" viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057c.002.022.015.043.032.054a19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/></svg>
              <input class="form-control" id="f_discord" type="text" placeholder="username#0000">
            </div>
          </div>
          <div class="form-group">
            <label>ВКонтакте (ссылка)</label>
            <div class="input-wrap">
              <svg class="ico" viewBox="0 0 24 24" fill="currentColor"><path d="M21.547 7h-3.29a.743.743 0 0 0-.655.392s-1.312 2.416-1.734 3.23C14.734 12.813 14 12.126 14 11.11V7.603A1.104 1.104 0 0 0 12.896 6.5h-2.474a1.982 1.982 0 0 0-1.75.813s1.255-.204 1.255 1.49c0 .42.022 1.626.04 2.64a.73.73 0 0 1-1.272.503 21.54 21.54 0 0 1-2.498-4.543.693.693 0 0 0-.63-.403h-2.99a.508.508 0 0 0-.48.685C3.005 10.175 6.918 18 11.38 18h1.878a.742.742 0 0 0 .742-.742v-1.135a.73.73 0 0 1 1.23-.53l2.247 2.112a1.09 1.09 0 0 0 .816.355h2.309a1.09 1.09 0 0 0 .972-1.587l-1.956-3.415a.73.73 0 0 1 .098-.846l3.83-4.48A.744.744 0 0 0 21.547 7z"/></svg>
              <input class="form-control" id="f_vk" type="text" placeholder="https://vk.com/id...">
            </div>
            <div class="hint">Полная ссылка на профиль ВКонтакте</div>
          </div>
        </div>
      </div>

      <button class="btn-reg" id="regBtn" onclick="doRegister()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg>
        Зарегистрироваться
      </button>
    </div>

    <div class="success-box" id="successBox">
      <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="1.6"><circle cx="12" cy="12" r="10"/><polyline points="9 12 11 14 15 10"/></svg>
      <h3>Аккаунт создан</h3>
      <p>Добро пожаловать в Arizona Prime Staff.<br>Теперь ты можешь <a href="index.html">войти в систему</a>.</p>
    </div>
  </div>

  <a href="index.html" class="back-link">← Вернуться ко входу</a>
</div>

<script>
const SB_URL = 'https://mnzayheqmplwgcpgapwn.supabase.co';
const SB_KEY = 'sb_publishable_taiYP-OlMMOXB4NYIpgKOQ_7JLaUPpU';

async function sb(path, method='GET', body=null) {
  const opts = { method, headers:{'apikey':SB_KEY,'Authorization':'Bearer '+SB_KEY,'Content-Type':'application/json','Prefer':'return=representation'}};
  if (body) opts.body = JSON.stringify(body);
  const r = await fetch(SB_URL+'/rest/v1/'+path, opts);
  if (!r.ok) throw new Error(await r.text());
  const t = await r.text(); return t ? JSON.parse(t) : [];
}

function showErr(msg) {
  const el = document.getElementById('errBox');
  el.textContent = msg; el.style.display = 'block';
  window.scrollTo({top: 0, behavior:'smooth'});
}

async function doRegister() {
  const nick  = document.getElementById('f_nick').value.trim();
  const pass  = document.getElementById('f_pass').value;
  const name  = document.getElementById('f_name').value.trim();
  const pos   = document.getElementById('f_pos').value.trim();
  const level = parseInt(document.getElementById('f_level').value);
  const appt  = document.getElementById('f_appoint').value;
  const promo = document.getElementById('f_promo').value;
  const disc  = document.getElementById('f_discord').value.trim();
  const vk    = document.getElementById('f_vk').value.trim();

  if (!nick) return showErr('Укажи никнейм');
  if (!pass || pass.length < 6) return showErr('Пароль минимум 6 символов');
  if (!name) return showErr('Укажи реальное имя');
  if (!pos) return showErr('Укажи должность');
  if (!level) return showErr('Выбери уровень');
  if (!appt) return showErr('Укажи дату постановления');

  const btn = document.getElementById('regBtn');
  btn.innerHTML = '<span class="spin"></span> Сохранение...';
  btn.disabled = true;
  document.getElementById('errBox').style.display = 'none';

  try {
    // Check nickname uniqueness
    const existing = await sb('users?nickname=eq.'+encodeURIComponent(nick)+'&select=id');
    if (existing.length) { showErr('Этот никнейм уже занят'); btn.innerHTML = 'Зарегистрироваться'; btn.disabled = false; return; }

    await sb('users', 'POST', {
      nickname: nick, password: pass, real_name: name,
      position: pos, level: level,
      appointment_date: appt, last_promotion_date: promo || appt,
      discord: disc || null, vk_url: vk || null,
      avatar: null, is_inactive: false,
      warnings: 0, reprimands: 0
    });

    document.getElementById('regForm').style.display = 'none';
    document.getElementById('successBox').style.display = 'block';
  } catch(e) {
    showErr('Ошибка: ' + e.message);
    btn.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" y1="8" x2="19" y2="14"/><line x1="22" y1="11" x2="16" y2="11"/></svg> Зарегистрироваться';
    btn.disabled = false;
  }
}
</script>
</body>
</html>
